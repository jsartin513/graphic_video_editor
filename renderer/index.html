<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Video Merger - Merge and manage GoPro video files">
  <meta name="color-scheme" content="light dark">
  <title>Video Merger</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a href="#main-content" class="skip-to-main">Skip to main content</a>
  <div class="app-container">
    <header class="app-header" role="banner">
      <h1>Video Merger</h1>
      <p class="subtitle">Select GoPro video files to merge</p>
    </header>

    <main id="main-content" class="main-content" role="main">
      <div class="selection-controls">
        <button id="selectFilesBtn" class="btn btn-primary" aria-label="Select video files">
          <span class="btn-icon" aria-hidden="true">üìÅ</span>
          Select Files
        </button>
        <button id="selectFolderBtn" class="btn btn-secondary" aria-label="Select folder containing videos">
          <span class="btn-icon" aria-hidden="true">üìÇ</span>
          Select Folder
        </button>
      </div>

      <div id="dropZone" class="drop-zone" role="button" tabindex="0" aria-label="Drop zone for video files and folders">
        <div class="drop-zone-content">
          <div class="drop-zone-icon" aria-hidden="true">üì§</div>
          <p class="drop-zone-text">Drag and drop video files or folders here</p>
          <p class="drop-zone-hint">or use the buttons above</p>
        </div>
      </div>

      <div id="fileListContainer" class="file-list-container" style="display: none;">
        <div class="file-list-header">
          <h2>Selected Videos</h2>
          <span id="fileCount" class="file-count" aria-live="polite">0 files</span>
        </div>
        <div id="fileList" class="file-list" role="list" aria-label="Selected video files"></div>
        <div class="file-list-actions">
          <button id="prepareMergeBtn" class="btn btn-primary" style="display: none;" aria-label="Prepare merge of selected videos">
            <span class="btn-icon" aria-hidden="true">‚ñ∂</span>
            Prepare Merge
          </button>
        </div>
      </div>

      <!-- Preview Screen -->
      <div id="previewScreen" class="preview-screen" style="display: none;">
        <div class="preview-header">
          <h2>Preview Merge</h2>
          <p class="preview-subtitle">Review and edit output filenames before merging</p>
        </div>
        
        <div id="previewList" class="preview-list" role="list" aria-label="Preview of videos to merge"></div>
        
        <div class="output-destination-section">
          <label class="output-destination-label">Output Destination:</label>
          <div class="output-destination-controls">
            <div id="outputDestinationDisplay" class="output-destination-display">
              <span id="outputDestinationPath" class="output-destination-path">Using default location (merged_videos subfolder)</span>
            </div>
            <button id="selectOutputDestinationBtn" class="btn btn-secondary btn-small" aria-label="Choose output folder">
              <span class="btn-icon" aria-hidden="true">üìÅ</span>
              Choose Folder
            </button>
            <button id="useDefaultDestinationBtn" class="btn btn-text btn-small" style="display: none;" aria-label="Use default output destination">
              Use Default
            </button>
          </div>
        </div>
        
        <div class="quality-section">
          <label class="quality-label">Video Quality:</label>
          <div class="quality-controls">
            <select id="qualitySelect" class="quality-select" aria-label="Select video quality">
              <option value="copy">Copy (Fastest, No Re-encoding)</option>
              <option value="high">High Quality (CRF 18, Slower)</option>
              <option value="medium">Medium Quality (CRF 23, Balanced)</option>
              <option value="low">Low Quality (CRF 28, Smaller File)</option>
            </select>
            <small class="quality-hint">Higher quality = larger file size, longer processing time</small>
          </div>
        </div>
        
        <div class="format-section">
          <label class="format-label">Export Format:</label>
          <div class="format-controls">
            <select id="formatSelect" class="format-select" aria-label="Select export format">
              <option value="mp4">MP4 (H.264, Most Compatible)</option>
              <option value="mov">MOV (QuickTime, macOS/iOS)</option>
              <option value="mkv">MKV (Matroska, Open Format)</option>
              <option value="avi">AVI (Legacy Windows)</option>
              <option value="m4v">M4V (iTunes/Apple)</option>
            </select>
            <small class="format-hint">MP4 recommended for best compatibility</small>
          </div>
        </div>
        
        <div class="preview-actions">
          <button id="backBtn" class="btn btn-secondary" aria-label="Go back to file selection">
            <span class="btn-icon" aria-hidden="true">‚Üê</span>
            Back
          </button>
          <button id="mergeBtn" class="btn btn-primary" aria-label="Start merging videos">
            <span class="btn-icon" aria-hidden="true">üé¨</span>
            Merge Videos
          </button>
        </div>
      </div>

      <!-- Progress Screen -->
      <div id="progressScreen" class="progress-screen" style="display: none;">
        <div class="progress-content">
          <h2>Merging Videos</h2>
          <div class="progress-bar-container" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Merge progress">
            <div id="progressBar" class="progress-bar"></div>
          </div>
          <p id="progressText" class="progress-text" aria-live="polite">Preparing...</p>
          <div id="progressDetails" class="progress-details" aria-live="polite"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- Split Video Modal -->
  <div id="splitVideoModal" class="modal-overlay" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="splitModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="splitModalTitle">Split Video</h2>
        <button id="closeSplitModalBtn" class="modal-close-btn" aria-label="Close split video dialog">√ó</button>
      </div>
      <div class="modal-body">
        <div class="split-video-info">
          <p><strong>Video:</strong> <span id="splitVideoName"></span></p>
          <p><strong>Duration:</strong> <span id="splitVideoDuration"></span></p>
        </div>
        
        <fieldset class="split-mode-selector">
          <legend class="sr-only">Split mode</legend>
          <label>
            <input type="radio" name="splitMode" value="uniform" checked>
            Simple: Split into segments of equal duration
          </label>
        </fieldset>

        <div id="uniformSplitSettings" class="split-settings">
          <div class="form-group">
            <label for="segmentMinutes">Duration per segment:</label>
            <div class="duration-input-group">
              <input type="number" id="segmentMinutes" min="1" max="120" value="20" class="duration-input">
              <span class="duration-label">minutes</span>
            </div>
            <p class="form-hint">The video will be split into segments of this duration</p>
          </div>
          
          <div class="split-preview">
            <p><strong>Preview:</strong> <span id="splitPreview" aria-live="polite">Calculating...</span></p>
          </div>
        </div>

        <div id="splitProgress" class="split-progress" style="display: none;" role="status" aria-live="polite">
          <div class="progress-bar-container">
            <div id="splitProgressBar" class="progress-bar"></div>
          </div>
          <p id="splitProgressText" class="progress-text">Splitting...</p>
        </div>

        <div id="splitResult" class="split-result" style="display: none;" aria-live="polite"></div>
      </div>
      <div class="modal-footer">
        <button id="cancelSplitBtn" class="btn btn-secondary" aria-label="Cancel split operation">Cancel</button>
        <button id="executeSplitBtn" class="btn btn-primary" aria-label="Execute video split">
          <span class="btn-icon" aria-hidden="true">‚úÇÔ∏è</span>
          Split Video
        </button>
      </div>
    </div>
  </div>

  <!-- Prerequisites Modal -->
  <div id="prerequisitesModal" class="modal-overlay" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="prerequisitesModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="prerequisitesModalTitle">‚ö†Ô∏è Prerequisites Required</h2>
      </div>
      <div class="modal-body">
        <p>Video Merger requires <strong>ffmpeg</strong> to merge videos, but it's not installed on your system.</p>
        
        <div id="prerequisitesStatus" class="prerequisites-status" role="status" aria-live="polite">
          <div class="status-item">
            <span id="ffmpegStatus" class="status-icon" aria-label="ffmpeg status">‚ùå</span>
            <span>ffmpeg</span>
          </div>
          <div class="status-item">
            <span id="ffprobeStatus" class="status-icon" aria-label="ffprobe status">‚ùå</span>
            <span>ffprobe</span>
          </div>
          <div class="status-item">
            <span id="brewStatus" class="status-icon" aria-label="Homebrew status">‚ùå</span>
            <span>Homebrew</span>
          </div>
        </div>

        <div id="installInstructions" class="install-instructions">
          <h3>Installation Options:</h3>
          <div class="install-option">
            <h4>Option 1: Automatic Installation (Recommended)</h4>
            <p>Click the button below to automatically install ffmpeg using Homebrew.</p>
            <button id="installBtn" class="btn btn-primary" aria-label="Install ffmpeg automatically using Homebrew">
              <span class="btn-icon" aria-hidden="true">‚¨á</span>
              Install ffmpeg Automatically
            </button>
          </div>
          
          <div class="install-option">
            <h4>Option 2: Manual Installation</h4>
            <p>Open Terminal and run:</p>
            <code class="install-code">brew install ffmpeg</code>
            <p class="install-note">If you don't have Homebrew, install it from <a href="https://brew.sh" target="_blank" rel="noopener noreferrer">brew.sh</a></p>
          </div>

          <div class="install-option">
            <h4>Option 3: Use Installation Script</h4>
            <p>Run the provided installation script:</p>
            <code class="install-code">./install_prerequisites.sh</code>
          </div>
        </div>

        <div id="installProgress" class="install-progress" style="display: none;" role="status" aria-live="polite">
          <div class="progress-bar-container">
            <div id="installProgressBar" class="progress-bar"></div>
          </div>
          <p id="installProgressText" class="progress-text">Installing...</p>
        </div>

        <div id="installResult" class="install-result" style="display: none;" aria-live="polite"></div>
      </div>
      <div class="modal-footer">
        <button id="checkAgainBtn" class="btn btn-secondary" style="display: none;" aria-label="Check prerequisites again">
          Check Again
        </button>
        <button id="closeModalBtn" class="btn btn-secondary" aria-label="Close prerequisites dialog and continue anyway">
          Continue Anyway
        </button>
      </div>
    </div>
  </div>

  <script type="module" src="renderer.js"></script>
</body>
</html>

